<div class="gallery-item">
  <div class="gallery-image-container">
    <img src="" alt="Gallery Image" loading="lazy">
    <div class="gallery-overlay">
      <div class="overlay-content">
        <h4 class="gallery-title"></h4>
        <p class="gallery-description"></p>
        <div class="gallery-meta">
          <span class="gallery-category"></span>
          <span class="gallery-date"></span>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .gallery-item {
    border-radius: 12px;
    overflow: hidden;
    position: relative;
    aspect-ratio: 1;
    cursor: pointer;
    transition: transform var(--transition-normal);
  }
  
  .gallery-item:hover {
    transform: translateY(-8px);
  }
  
  .gallery-image-container {
    position: relative;
    width: 100%;
    height: 100%;
    overflow: hidden;
  }
  
  .gallery-image-container img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform var(--transition-normal);
  }
  
  .gallery-item:hover .gallery-image-container img {
    transform: scale(1.1);
  }
  
  .gallery-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(transparent, rgba(0, 0, 0, 0.9));
    color: var(--white);
    padding: 1.5rem;
    transform: translateY(100%);
    transition: transform var(--transition-normal);
  }
  
  .gallery-item:hover .gallery-overlay {
    transform: translateY(0);
  }
  
  .overlay-content {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }
  
  .gallery-title {
    margin: 0;
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--white);
  }
  
  .gallery-description {
    margin: 0;
    font-size: 0.9rem;
    opacity: 0.9;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  .gallery-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 0.5rem;
  }
  
  .gallery-category {
    background: var(--gold);
    color: var(--dark-blue);
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.8rem;
    font-weight: 500;
    text-transform: capitalize;
  }
  
  .gallery-date {
    font-size: 0.8rem;
    opacity: 0.8;
  }
</style>

<script>
  class GalleryItem extends HTMLElement {
    static get observedAttributes() {
      return ['data-item']
    }
    
    attributeChangedCallback(name, oldValue, newValue) {
      if (name === 'data-item' && newValue) {
        this.item = JSON.parse(newValue)
        this.render()
        this.setupLightbox()
      }
    }
    
    render() {
      if (!this.item) return
      
      const img = this.querySelector('img')
      const title = this.querySelector('.gallery-title')
      const description = this.querySelector('.gallery-description')
      const category = this.querySelector('.gallery-category')
      const date = this.querySelector('.gallery-date')
      
      img.src = this.item.image_url || '/images/gallery-default.jpg'
      img.alt = this.item.title || this.item.description || 'Gallery image'
      
      if (title) title.textContent = this.item.title || ''
      if (description) description.textContent = this.item.description || ''
      
      if (category) {
        category.textContent = this.item.category || 'general'
      }
      
      if (date && this.item.created_at) {
        const dateObj = new Date(this.item.created_at)
        date.textContent = dateObj.toLocaleDateString()
      }
    }
    
    setupLightbox() {
      this.addEventListener('click', () => {
        this.openLightbox()
      })
    }
    
    openLightbox() {
      const modal = document.createElement('div')
      modal.className = 'lightbox-modal'
      modal.innerHTML = `
        <div class="lightbox-content">
          <button class="lightbox-close">&times;</button>
          <button class="lightbox-nav prev">&larr;</button>
          <button class="lightbox-nav next">&rarr;</button>
          
          <div class="lightbox-image">
            <img src="${this.item.image_url}" alt="${this.item.title || this.item.description || 'Gallery image'}">
          </div>
          
          <div class="lightbox-info">
            ${this.item.title ? `<h3>${this.item.title}</h3>` : ''}
            ${this.item.description ? `<p>${this.item.description}</p>` : ''}
            <div class="lightbox-meta">
              ${this.item.category ? `<span class="category">${this.item.category}</span>` : ''}
              ${this.item.created_at ? `<span class="date">${new Date(this.item.created_at).toLocaleDateString()}</span>` : ''}
            </div>
          </div>
        </div>
      `
      
      document.body.appendChild(modal)
      document.body.style.overflow = 'hidden'
      
      modal.querySelector('.lightbox-close').addEventListener('click', () => {
        modal.remove()
        document.body.style.overflow = ''
      })
      
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          modal.remove()
          document.body.style.overflow = ''
        }
      })
      
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          modal.remove()
          document.body.style.overflow = ''
        }
      })
    }
  }
  
  customElements.define('gallery-item', GalleryItem)
  
  const style = document.createElement('style')
  style.textContent = `
    .lightbox-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.95);
      z-index: 10000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem;
      animation: fadeIn 0.3s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .lightbox-content {
      position: relative;
      max-width: 90vw;
      max-height: 90vh;
      width: auto;
      height: auto;
    }
    
    .lightbox-close {
      position: absolute;
      top: -50px;
      right: 0;
      background: none;
      border: none;
      color: var(--white);
      font-size: 2.5rem;
      cursor: pointer;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10001;
      opacity: 0.8;
      transition: opacity var(--transition-fast);
    }
    
    .lightbox-close:hover {
      opacity: 1;
    }
    
    .lightbox-nav {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(0, 0, 0, 0.5);
      border: none;
      color: var(--white);
      font-size: 1.5rem;
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      border-radius: 50%;
      z-index: 10001;
      opacity: 0.7;
      transition: opacity var(--transition-fast);
    }
    
    .lightbox-nav:hover {
      opacity: 1;
    }
    
    .lightbox-nav.prev {
      left: 20px;
    }
    
    .lightbox-nav.next {
      right: 20px;
    }
    
    .lightbox-image {
      max-width: 100%;
      max-height: 70vh;
      overflow: hidden;
      border-radius: 8px;
    }
    
    .lightbox-image img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
    
    .lightbox-info {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      padding: 1.5rem;
      border-radius: 8px;
      margin-top: 1rem;
      color: var(--white);
    }
    
    .lightbox-info h3 {
      margin: 0 0 0.5rem;
      color: var(--white);
    }
    
    .lightbox-info p {
      margin: 0 0 1rem;
      opacity: 0.9;
      line-height: 1.5;
    }
    
    .lightbox-meta {
      display: flex;
      gap: 1rem;
      font-size: 0.9rem;
    }
    
    .lightbox-meta .category {
      background: var(--gold);
      color: var(--dark-blue);
      padding: 0.25rem 0.75rem;
      border-radius: 12px;
      font-weight: 500;
    }
    
    .lightbox-meta .date {
      opacity: 0.8;
    }
    
    @media (max-width: 768px) {
      .lightbox-modal {
        padding: 1rem;
      }
      
      .lightbox-nav {
        width: 40px;
        height: 40px;
        font-size: 1.2rem;
      }
      
      .lightbox-nav.prev {
        left: 10px;
      }
      
      .lightbox-nav.next {
        right: 10px;
      }
      
      .lightbox-close {
        top: -40px;
        font-size: 2rem;
      }
    }
  `
  document.head.appendChild(style)
</script>
